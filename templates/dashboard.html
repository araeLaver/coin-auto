<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Auto Coin Trading Dashboard</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: #0a0e27; color: #fff; }
        .container { max-width: 1400px; margin: 0 auto; padding: 20px; }

        /* Header */
        .header { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 30px; border-radius: 10px; margin-bottom: 30px; }
        .header h1 { font-size: 32px; margin-bottom: 10px; }
        .header .status { display: flex; gap: 30px; margin-top: 15px; }
        .status-item { background: rgba(255,255,255,0.1); padding: 10px 20px; border-radius: 5px; }
        .status-item strong { display: block; font-size: 24px; margin-top: 5px; }

        /* Stats Grid */
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .stat-card { background: #1a1f3a; padding: 20px; border-radius: 10px; border-left: 4px solid #667eea; }
        .stat-card h3 { color: #9ca3af; font-size: 14px; margin-bottom: 10px; }
        .stat-card .value { font-size: 28px; font-weight: bold; }
        .stat-card.positive .value { color: #10b981; }
        .stat-card.negative .value { color: #ef4444; }

        /* Table */
        .card { background: #1a1f3a; border-radius: 10px; padding: 20px; margin-bottom: 20px; }
        .card h2 { margin-bottom: 20px; font-size: 20px; }
        table { width: 100%; border-collapse: collapse; }
        th { text-align: left; padding: 12px; background: #0a0e27; font-weight: 600; font-size: 13px; color: #9ca3af; }
        td { padding: 12px; border-top: 1px solid #2a2f4a; }
        .badge { padding: 4px 12px; border-radius: 20px; font-size: 12px; font-weight: 600; }
        .badge.long { background: #10b98120; color: #10b981; }
        .badge.short { background: #ef444420; color: #ef4444; }
        .badge.buy { background: #3b82f620; color: #3b82f6; }
        .badge.sell { background: #f59e0b20; color: #f59e0b; }
        .positive { color: #10b981; }
        .negative { color: #ef4444; }

        /* Loading */
        .loading { text-align: center; padding: 40px; color: #9ca3af; }

        /* Refresh */
        .refresh-btn { background: #667eea; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; margin-bottom: 20px; }
        .refresh-btn:hover { background: #5568d3; }

        /* Auto refresh indicator */
        .auto-refresh { position: fixed; top: 20px; right: 20px; background: #10b981; padding: 10px 20px; border-radius: 5px; font-size: 14px; }
    </style>
</head>
<body>
    <div class="auto-refresh">ğŸ”„ ìë™ ìƒˆë¡œê³ ì¹¨ (10ì´ˆ)</div>

    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>ğŸ¤– Auto Coin Trading Dashboard</h1>
            <div class="status">
                <div class="status-item">
                    <div>ëª¨ë“œ</div>
                    <strong id="mode">-</strong>
                </div>
                <div class="status-item">
                    <div>ì´ ìì‚°</div>
                    <strong id="balance">-</strong>
                </div>
                <div class="status-item">
                    <div>ê°€ìš© ê¸ˆì•¡</div>
                    <strong id="available">-</strong>
                </div>
                <div class="status-item">
                    <div>ì˜¤í”ˆ í¬ì§€ì…˜</div>
                    <strong id="open-positions">-</strong>
                </div>
                <div class="status-item">
                    <div>ì˜¤ëŠ˜ ê±°ë˜</div>
                    <strong id="today-trades">-</strong>
                </div>
            </div>
        </div>

        <!-- Summary Stats -->
        <div class="stats-grid" id="summary-stats">
            <div class="stat-card">
                <h3>ì´ ê±°ë˜ ìˆ˜</h3>
                <div class="value" id="total-trades">-</div>
            </div>
            <div class="stat-card">
                <h3>ìŠ¹ë¥ </h3>
                <div class="value" id="win-rate">-</div>
            </div>
            <div class="stat-card">
                <h3>ì´ ì†ìµ</h3>
                <div class="value" id="total-pnl">-</div>
            </div>
            <div class="stat-card">
                <h3>ì´ ìˆ˜ìµë¥ </h3>
                <div class="value" id="total-return">-</div>
            </div>
        </div>

        <!-- Real Wallet Holdings -->
        <div class="card">
            <h2>ğŸ’¼ ì‹¤ì œ ë³´ìœ  ì½”ì¸ (ë¹—ì¸ ì§€ê°‘)</h2>
            <table id="holdings-table">
                <thead>
                    <tr>
                        <th>ì‹¬ë³¼</th>
                        <th>ë³´ìœ ëŸ‰</th>
                        <th>í˜„ì¬ê°€</th>
                        <th>í‰ê°€ê¸ˆì•¡</th>
                    </tr>
                </thead>
                <tbody>
                    <tr><td colspan="4" class="loading">ë°ì´í„° ë¡œë”© ì¤‘...</td></tr>
                </tbody>
            </table>
        </div>

        <!-- Open Positions -->
        <div class="card">
            <h2>ğŸ“Š ìë™ë§¤ë§¤ ì˜¤í”ˆ í¬ì§€ì…˜</h2>
            <table id="positions-table">
                <thead>
                    <tr>
                        <th>ì‹¬ë³¼</th>
                        <th>íƒ€ì…</th>
                        <th>ì§„ì…ê°€</th>
                        <th>í˜„ì¬ê°€</th>
                        <th>ìˆ˜ëŸ‰</th>
                        <th>ì†ìµ</th>
                        <th>ì†ìµë¥ </th>
                        <th>ë³´ìœ ì‹œê°„</th>
                    </tr>
                </thead>
                <tbody>
                    <tr><td colspan="8" class="loading">ë°ì´í„° ë¡œë”© ì¤‘...</td></tr>
                </tbody>
            </table>
        </div>

        <!-- Recent Trades -->
        <div class="card">
            <h2>ğŸ“ˆ ìµœê·¼ ê±°ë˜ ë‚´ì—­</h2>
            <table id="trades-table">
                <thead>
                    <tr>
                        <th>ì‹¬ë³¼</th>
                        <th>ì§„ì…ê°€</th>
                        <th>ì²­ì‚°ê°€</th>
                        <th>ì†ìµ</th>
                        <th>ì†ìµë¥ </th>
                        <th>ì¢…ë£Œì‚¬ìœ </th>
                        <th>ë³´ìœ ì‹œê°„</th>
                        <th>ì²­ì‚°ì‹œê°„</th>
                    </tr>
                </thead>
                <tbody>
                    <tr><td colspan="8" class="loading">ë°ì´í„° ë¡œë”© ì¤‘...</td></tr>
                </tbody>
            </table>
        </div>

        <!-- Strategy Performance -->
        <div class="card">
            <h2>ğŸ¯ ì „ëµë³„ ì„±ê³¼</h2>
            <table id="strategies-table">
                <thead>
                    <tr>
                        <th>ì „ëµ</th>
                        <th>ê±°ë˜ ìˆ˜</th>
                        <th>ì´ ì†ìµ</th>
                        <th>í‰ê·  ì†ìµë¥ </th>
                        <th>ìŠ¹ë¥ </th>
                    </tr>
                </thead>
                <tbody>
                    <tr><td colspan="5" class="loading">ë°ì´í„° ë¡œë”© ì¤‘...</td></tr>
                </tbody>
            </table>
        </div>

        <!-- Recent Signals -->
        <div class="card">
            <h2>ğŸ”” ìµœê·¼ ì‹œê·¸ë„</h2>
            <table id="signals-table">
                <thead>
                    <tr>
                        <th>ì „ëµ</th>
                        <th>ì‹¬ë³¼</th>
                        <th>ì‹œê·¸ë„</th>
                        <th>ê°•ë„</th>
                        <th>ì‹ ë¢°ë„</th>
                        <th>ì§„ì…ê°€</th>
                        <th>ì‚¬ìœ </th>
                        <th>ì‹œê°„</th>
                    </tr>
                </thead>
                <tbody>
                    <tr><td colspan="8" class="loading">ë°ì´í„° ë¡œë”© ì¤‘...</td></tr>
                </tbody>
            </table>
        </div>
    </div>

    <script>
        function formatKRW(num) {
            return new Intl.NumberFormat('ko-KR', { style: 'currency', currency: 'KRW', minimumFractionDigits: 0 }).format(num);
        }

        function formatPercent(num) {
            return (num >= 0 ? '+' : '') + num.toFixed(2) + '%';
        }

        function formatTime(isoString) {
            const date = new Date(isoString);
            return date.toLocaleString('ko-KR', { month: '2-digit', day: '2-digit', hour: '2-digit', minute: '2-digit' });
        }

        async function loadStatus() {
            const res = await fetch('/api/status');
            const data = await res.json();

            document.getElementById('mode').textContent = data.mode === 'live' ? 'ğŸ”´ ì‹¤ì „' : 'ğŸ“ ëª¨ì˜';
            document.getElementById('balance').textContent = formatKRW(data.balance);
            document.getElementById('available').textContent = formatKRW(data.available_krw);
            document.getElementById('open-positions').textContent = data.open_positions;
            document.getElementById('today-trades').textContent = data.today_trades;

            // ì½”ì¸ í‰ê°€ì•¡ í‘œì‹œ
            if (data.crypto_value > 0) {
                document.getElementById('balance').innerHTML = formatKRW(data.balance) +
                    '<br><small style="color: #9ca3af;">ì½”ì¸: ' + formatKRW(data.crypto_value) + '</small>';
            }
        }

        async function loadSummary() {
            const res = await fetch('/api/summary');
            const data = await res.json();

            document.getElementById('total-trades').textContent = data.total_trades;
            document.getElementById('win-rate').textContent = data.win_rate.toFixed(1) + '%';
            document.getElementById('total-pnl').textContent = formatKRW(data.total_pnl);
            document.getElementById('total-pnl').className = 'value ' + (data.total_pnl >= 0 ? 'positive' : 'negative');
            document.getElementById('total-return').textContent = formatPercent(data.total_return);
            document.getElementById('total-return').className = 'value ' + (data.total_return >= 0 ? 'positive' : 'negative');
        }

        async function loadHoldings() {
            const res = await fetch('/api/holdings');
            const data = await res.json();

            const tbody = document.querySelector('#holdings-table tbody');

            if (data.length === 0) {
                tbody.innerHTML = '<tr><td colspan="4" class="loading">ë³´ìœ  ì½”ì¸ ì—†ìŒ</td></tr>';
                return;
            }

            tbody.innerHTML = data.map(h => `
                <tr>
                    <td><strong>${h.symbol}</strong></td>
                    <td>${h.balance.toFixed(8)}</td>
                    <td>${formatKRW(h.current_price)}</td>
                    <td><strong>${formatKRW(h.value)}</strong></td>
                </tr>
            `).join('');
        }

        async function loadPositions() {
            const res = await fetch('/api/positions');
            const data = await res.json();

            const tbody = document.querySelector('#positions-table tbody');

            if (data.length === 0) {
                tbody.innerHTML = '<tr><td colspan="8" class="loading">ì˜¤í”ˆ í¬ì§€ì…˜ ì—†ìŒ</td></tr>';
                return;
            }

            tbody.innerHTML = data.map(p => `
                <tr>
                    <td><strong>${p.symbol}</strong></td>
                    <td><span class="badge ${p.type.toLowerCase()}">${p.type}</span></td>
                    <td>${formatKRW(p.entry_price)}</td>
                    <td>${formatKRW(p.current_price)}</td>
                    <td>${p.quantity.toFixed(6)}</td>
                    <td class="${p.pnl >= 0 ? 'positive' : 'negative'}">${formatKRW(p.pnl)}</td>
                    <td class="${p.pnl_percent >= 0 ? 'positive' : 'negative'}">${formatPercent(p.pnl_percent)}</td>
                    <td>${p.holding_time.split('.')[0]}</td>
                </tr>
            `).join('');
        }

        async function loadTrades() {
            const res = await fetch('/api/trades');
            const data = await res.json();

            const tbody = document.querySelector('#trades-table tbody');

            if (data.length === 0) {
                tbody.innerHTML = '<tr><td colspan="8" class="loading">ê±°ë˜ ë‚´ì—­ ì—†ìŒ</td></tr>';
                return;
            }

            tbody.innerHTML = data.slice(0, 20).map(t => `
                <tr>
                    <td><strong>${t.symbol}</strong></td>
                    <td>${formatKRW(t.entry_price)}</td>
                    <td>${formatKRW(t.exit_price)}</td>
                    <td class="${t.pnl >= 0 ? 'positive' : 'negative'}">${formatKRW(t.pnl)}</td>
                    <td class="${t.pnl_percent >= 0 ? 'positive' : 'negative'}">${formatPercent(t.pnl_percent)}</td>
                    <td>${t.exit_reason}</td>
                    <td>${t.holding_time}ë¶„</td>
                    <td>${formatTime(t.closed_at)}</td>
                </tr>
            `).join('');
        }

        async function loadStrategies() {
            const res = await fetch('/api/strategies');
            const data = await res.json();

            const tbody = document.querySelector('#strategies-table tbody');

            if (data.length === 0) {
                tbody.innerHTML = '<tr><td colspan="5" class="loading">ì „ëµ ë°ì´í„° ì—†ìŒ</td></tr>';
                return;
            }

            tbody.innerHTML = data.map(s => `
                <tr>
                    <td><strong>${s.strategy}</strong></td>
                    <td>${s.total_trades}</td>
                    <td class="${s.total_pnl >= 0 ? 'positive' : 'negative'}">${formatKRW(s.total_pnl)}</td>
                    <td class="${s.avg_pnl_percent >= 0 ? 'positive' : 'negative'}">${formatPercent(s.avg_pnl_percent)}</td>
                    <td>${s.win_rate.toFixed(1)}%</td>
                </tr>
            `).join('');
        }

        async function loadSignals() {
            const res = await fetch('/api/signals');
            const data = await res.json();

            const tbody = document.querySelector('#signals-table tbody');

            if (data.length === 0) {
                tbody.innerHTML = '<tr><td colspan="8" class="loading">ì‹œê·¸ë„ ì—†ìŒ</td></tr>';
                return;
            }

            tbody.innerHTML = data.slice(0, 10).map(s => `
                <tr>
                    <td>${s.strategy}</td>
                    <td><strong>${s.symbol}</strong></td>
                    <td><span class="badge ${s.signal_type.toLowerCase()}">${s.signal_type}</span></td>
                    <td>${s.strength.toFixed(0)}</td>
                    <td>${(s.confidence * 100).toFixed(0)}%</td>
                    <td>${formatKRW(s.entry_price)}</td>
                    <td style="max-width: 300px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">${s.reasoning}</td>
                    <td>${formatTime(s.timestamp)}</td>
                </tr>
            `).join('');
        }

        async function loadAll() {
            await Promise.all([
                loadStatus(),
                loadSummary(),
                loadHoldings(),
                loadPositions(),
                loadTrades(),
                loadStrategies(),
                loadSignals()
            ]);
        }

        // ì´ˆê¸° ë¡œë“œ
        loadAll();

        // 10ì´ˆë§ˆë‹¤ ìë™ ìƒˆë¡œê³ ì¹¨
        setInterval(loadAll, 10000);
    </script>
</body>
</html>
